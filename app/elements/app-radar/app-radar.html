<link rel='import' href='../../../bower_components/polymer/polymer.html'>

<dom-module id='app-radar'>
    <style>
        :host {
            display: block;
            margin: 0px;
            padding: 0px;
        }

        section {
            position: relative;
            transform: translate(50px, 20px);
        }

       svg {
            position: absolute;
        }

        ul {
          position: relative;
          height: 15em;
          left: 2.4em;
          top: 4.8em;
          list-style: none;
        }

        iron-icon {
          position: absolute;
          -webkit-filter: drop-shadow( 0px 0px 3px rgba(0,0,0,.7) );
          filter: drop-shadow( 0px 0px 3px rgba(0,0,0,.7) );
          --iron-icon-width: 46px;
          --iron-icon-height: 46px;
        }
        li:nth-of-type(1) {
          transform: rotate(0deg) translateX(7em) rotate(0deg);
        }
        li:nth-of-type(2) {
          transform: rotate(36deg) translateX(7em) rotate(-36deg);
        }
        li:nth-of-type(3) {
          transform: rotate(72deg) translateX(7em) rotate(-72deg);
        }
        li:nth-of-type(4) {
          transform: rotate(108deg) translateX(7em) rotate(-108deg);
        }
        li:nth-of-type(5) {
          transform: rotate(144deg) translateX(7em) rotate(-144deg);
        }
        li:nth-of-type(6) {
          transform: rotate(180deg) translateX(7em) rotate(-180deg);
        }
        li:nth-of-type(7) {
          transform: rotate(216deg) translateX(7em) rotate(-216deg);
        }
        li:nth-of-type(8) {
          transform: rotate(252deg) translateX(7em) rotate(-252deg);
        }
        li:nth-of-type(9) {
          transform: rotate(288deg) translateX(7em) rotate(-288deg);
        }
        li:nth-of-type(10) {
          transform: rotate(324deg) translateX(7em) rotate(-324deg);
        }



        #radar {
            margin: auto;
        }
    </style>
    <template>
        <section>
            <svg id="radar"></svg>
            <ul>
                <li><iron-icon icon='criterias:theatre'></iron-icon></li>
                <li><iron-icon icon='criterias:music'></iron-icon></li>
                <li><iron-icon icon='criterias:cinema'></iron-icon></li>
                <li><iron-icon icon='criterias:monument'></iron-icon></li>
                <li><iron-icon icon='criterias:food'></iron-icon></li>
                <li><iron-icon icon='criterias:castle'></iron-icon></li>
                <li><iron-icon icon='criterias:book'></iron-icon></li>
                <li><iron-icon icon='criterias:people'></iron-icon></li>
                <li><iron-icon icon='criterias:cocktail'></iron-icon></li>
                <li><iron-icon icon='criterias:enceinte'></iron-icon></li>
            </ul>
        </section>
        <button on-click="clickHandler">change</button>
    </template>
    <script type='text/javascript' src='http://d3js.org/d3.v2.min.js'></script>
    <script>
        Polymer({
            is: 'app-radar',
            properties: {
                criterias: {
                    type: Array
                },
                _scale: {
                    type: Object
                }
            },
            observers: [
                'newCriterias(criterias.*)'
            ],
            newCriterias: function(changeRecord) {
                if (changeRecord.path == 'criterias.splices') {
                } else {
                  // an individual user or its sub-properties changed
                  // check "changeRecord.path" to determine what changed


                var scale = this._scale;

                var radar = this.$$('#radar');
                var svg = d3.select(radar);

                        var points =
                            svg
                                .selectAll('.points')
                                .data(changeRecord.value)
                                .transition()
                                .duration(1000)
                                .attr('cx', function(d, i) { return Math.cos(i * 2 * Math.PI / (changeRecord.value.length)) * scale(d.value);})
                                .attr('cy', function(d, i) { return Math.sin(i * 2 * Math.PI / (changeRecord.value.length)) * scale(d.value);});

                        svg
                            .selectAll('.polygon')
                            .data([changeRecord.value])
                            .transition()
                            .duration(1000)
                            .attr('points', function(a, i) {
                                   return a.map(function(d, i) {
                                        return [
                                            Math.cos(i * 2 * Math.PI / (changeRecord.value.length)) * scale(d.value),
                                            Math.sin(i * 2 * Math.PI / (changeRecord.value.length)) * scale(d.value)
                                        ].join(',');
                                    }).join(' ');
                            });
                    }

              },

            clickHandler: function() {
                this.criterias = [{value: Math.random()*10 %3 },{value: Math.random()*10 %3},{value: Math.random()*10 %3},{value: Math.random()*10 %3},{value: Math.random()*10 %3},{value: Math.random()*10 %3},{value: Math.random()*10 %3},{value: Math.random()*10 %3},{value: Math.random()*10 %3},{value: Math.random()*10 %3}];

//                this.criterias = [{value: 1},{value: 2},{value: 3},{value: 3},{value: 0},{value: 2},{value: 1},{value: 1},{value: 1},{value: 0}];
            },

            ready: function() {

                var data = [{value: 0},{value: 0},{value: 0},{value: 0},{value: 0},{value: 0},{value: 0},{value: 0},{value: 0},{value: 0}];

                var width = 200;
                var height = 200;
                var center = { x: width/2, y: height/2 };
                var levels = d3.max(data.map(function(d){return d.value})) + 1;
                levels = 4;

                var scale = d3.scale
                        .linear()
                        .domain([0, levels])
                        .range([0, width/2]);

                this._scale = scale;

                var radar = this.$$('#radar');
                var svg = d3.select(radar)
                    .attr('height', height)
                    .attr('width', width)
                    .append('g')
                    .attr('transform', 'translate(' + center.x +', ' + center.y + ')');

                for (var i=levels; i >= 0; i-=1) {
                    svg
                        .append('g')
                        .append('circle')
                        .attr('r', scale(i))
                        .attr('fill', 'white')
                        .attr('stroke', '#6892A8')
                        .attr('stroke-width', 0.6);
                }

                    svg
                        .append('g')
                        .selectAll('line')
                        .data(data)
                        .enter()
                            .append('line')
                            .attr('x2', function() { return scale(levels);})
                            .attr('stroke-width', 0.6)
                            .attr('stroke', '#6892A8')
                            .attr('transform', function(d, i) { return 'rotate(' + i*360/data.length + ')';});

                    var points =
                        svg
                            .selectAll('.points')
                            .data(data)
                                .enter()
                                .append('circle')
                                .attr('class', 'points')
                                .attr('r', 3)
                                .attr('fill', '#E30613')
                                .attr('cx', function(d, i) { return 0;})
                                .attr('cy', function(d, i) { return 0;});

                        svg
                            .selectAll('.polygon')
                            .data(points)
                            .enter()
                            .append('polygon')
                            .attr('class', 'polygon')
                            .attr('points', function(d) {
                                return d.map(function() {
                                    return [0, 0].join(',');
                                }).join(' ');
                            })
                            .attr('stroke', '#E30613')
                            .attr('stroke-width', 2)
                            .attr('fill', '#E30613')
                            .attr('opacity', 0.4);
                }
            });
    </script>
</dom-module>