<link rel='import' href='../../../bower_components/polymer/polymer.html'>

<dom-module id='app-radar'>
    <style>
        figure {
            position: relative;
            margin: 0px;
            padding: 0px;
        }
       svg {
            position: absolute;
            top: 1em;
            left:1.2em;


        }
        figcaption {
          position: relative;
          height:11em;
          left: 2.8em;
          top: 5em;
        }
        ul {
            list-style: none;
        }
        iron-icon {
          position: absolute;
          width: 2em;
          height: 2em;
    -webkit-filter: drop-shadow( 0px 0px 3px rgba(0,0,0,.7) );
            filter: drop-shadow( 0px 0px 3px rgba(0,0,0,.7) );
        }
        li:nth-of-type(1) {
          transform: rotate(0deg) translateX(5.2em) rotate(0deg);
        }
        li:nth-of-type(2) {
          transform: rotate(36deg) translateX(5.2em) rotate(-36deg);
        }
        li:nth-of-type(3) {
          transform: rotate(72deg) translateX(5.2em) rotate(-72deg);
        }
        li:nth-of-type(4) {
          transform: rotate(108deg) translateX(5.2em) rotate(-108deg);
        }
        li:nth-of-type(5) {
          transform: rotate(144deg) translateX(5.2em) rotate(-144deg);
        }
        li:nth-of-type(6) {
          transform: rotate(180deg) translateX(5.2em) rotate(-180deg);
        }
        li:nth-of-type(7) {
          transform: rotate(216deg) translateX(5.2em) rotate(-216deg);
        }
        li:nth-of-type(8) {
          transform: rotate(252deg) translateX(5.2em) rotate(-252deg);
        }
        li:nth-of-type(9) {
          transform: rotate(288deg) translateX(5.2em) rotate(-288deg);
        }
        li:nth-of-type(10) {
          transform: rotate(324deg) translateX(5.2em) rotate(-324deg);
        }
    </style>
    <template>
        <figure>
            <svg id="radar"></svg>
            <figcaption>
                <ul>
                    <li><iron-icon icon='criterias:theatre'></iron-icon></li>
                    <li><iron-icon icon='criterias:music'></iron-icon></li>
                    <li><iron-icon icon='criterias:cinema'></iron-icon></li>
                    <li><iron-icon icon='criterias:monument'></iron-icon></li>
                    <li><iron-icon icon='criterias:food'></iron-icon></li>
                    <li><iron-icon icon='criterias:castle'></iron-icon></li>
                    <li><iron-icon icon='criterias:book'></iron-icon></li>
                    <li><iron-icon icon='criterias:people'></iron-icon></li>
                    <li><iron-icon icon='criterias:cocktail'></iron-icon></li>
                    <li><iron-icon icon='criterias:enceinte'></iron-icon></li>
                </ul>
            </figcaption>
        <figure>
    </template>
    <script type='text/javascript' src='http://d3js.org/d3.v2.min.js'></script>
    <script>
        Polymer({
            is: 'app-radar',
            ready: function() {

            // tableau de data
            var data = [
                {criteria: 'crtit6', value: 2},
                {criteria: 'crtit7', value: 2},
                {criteria: 'crtit8', value: 1},
                {criteria: 'crtit9', value: 1},
                {criteria: 'crtit0', value: 2},
                {criteria: 'crtit1', value: 1},
                {criteria: 'crtit2', value: 1},
                {criteria: 'crtit3', value: 2},
                {criteria: 'crtit4', value: 3},
                {criteria: 'crtit5', value: 1},
            ];

            // on défini des variables width height et center 
            var width = 160;
            var height = 160;
            var center={x: width/2, y: height/2};

            var levels = d3.max(data.map(function(d){return d.value;})) + 1;

            // création du canvas svg 'radar'
            var radar = Polymer.dom(this.root).querySelector('#radar');

             var canvas = d3.select(radar)
                    .attr('height', height)
                    .attr('width', width)
                    .append('g')
                    .attr('transform', 'translate(0, 0)');

            // définition de l'echelle 
            var scale = d3.scale
                    .linear()
                    .domain([0, levels])
                    .range([0, width/2]);

            var cercles =
                canvas
                    .append('g')
                    .attr('transform', 'translate(' + center.x +', ' + center.y + ')');

            for (var i=levels; i >= 0; i-=1) {
                cercles
                    .append('circle')
                    .attr('r', scale(i))
                    .attr('fill', 'white')
                    .attr('stroke', '#6892A8')
                    .attr('stroke-width', 0.6);
            }

            var points  =
                canvas
                    .append('g')
                    .attr('transform', 'translate(' + center.x +', ' + center.y + ')')
                    .selectAll('circle')
                    .data(data)
                        .enter()
                        .append('circle')
                        .attr('r', 3)
                        .attr('fill', '#E30613')
                    .transition()
                    .duration(2000)

                        .attr('cx', function(d, i) { return Math.cos(i * 2 * Math.PI / (data.length)) * scale(d.value);})
                        .attr('cy', function(d, i) { return Math.sin(i * 2 * Math.PI / (data.length)) * scale(d.value);});

                canvas
                    .append('g')
                    .attr('transform', function() { return 'translate(' + center.x + ', ' + center.y + ')';})
                    .selectAll('line')
                    .data(data)
                    .enter()
                        .append('line')
                        .attr('x2', function() { return scale(levels);})
                        .attr('stroke-width', 0.6)
                        .attr('stroke', '#6892A8')
                        .attr('transform', function(d, i) { return 'rotate(' + i*360/data.length + ')';});

                canvas
                    .selectAll('polygon')
                    .data(points)
                    .enter()
                    .append('polygon')
                    .attr('transform', function() { return 'translate(' + center.x + ', ' + center.y + ')';})
                    .attr('points', function(d) {
                        return d.map(function() {
                            return [0, 0].join(',');
                        }).join(' ');
                    })
                    .attr('stroke', '#E30613')
                    .attr('stroke-width', 2)
                    .attr('fill', '#E30613')
                    .attr('opacity', 0.4)
                    .transition()
                    .duration(2000)
                    .attr('points', function(d) {
                        return d.map(function(d, i) {
                            return [
                                Math.cos(i*2*Math.PI/(data.length))*scale(d.node.__data__.value),
                                Math.sin(i*2*Math.PI/(data.length))*scale(d.node.__data__.value)].join(',');
                        }).join(' ');
                    });
            }
        });
    </script>
</dom-module>